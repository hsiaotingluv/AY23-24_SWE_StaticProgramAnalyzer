name: Code Coverage

on: [pull_request]

jobs: 
    coverage_report: 
        name: Generate coverage report
        runs-on: ubuntu-latest

        steps: 
            - name: Check out Git repo
              uses: actions/checkout@v3

            - name: Setup CMake
              run:  sudo apt update && sudo apt install -y cmake

            - name: Setup LCOV
              uses: hrishikesh-kadam/setup-lcov@v1
      
            - name: Build cmake
              run: |
                cd Team11/Code11
                mkdir build
                cd build
                cmake .. -DCMAKE_EXPORT_COMPILE_COMMANDS=1 -DCMAKE_BUILD_TYPE=Debug
                make -j4
                make SPA_coverage

            - name: Run cwd
              run: | 
                pwd
            
            - name: Report code coverage
              uses: zgosalvez/github-actions-report-lcov@v3
              with:
                coverage-files: Team11/Code11/build/SPA_coverage.info
                minimum-coverage: 50
                artifact-name: code-coverage-report
                github-token: ${{ secrets.GITHUB_TOKEN }}
                update-comment: true